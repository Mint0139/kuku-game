<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>チルノの九九教室（九九編）</title>
    <style>
        body { 
            text-align: center; 
            font-family: 'Helvetica Neue', Arial, sans-serif; 
            background-color: #e6f7ff; 
            color: #333; 
            margin: 0; 
            padding: 10px;
            display: flex;
            flex-direction: column;
            height: 100vh; 
            box-sizing: border-box;
        }

        h1 { color: #0074d9; font-size: 18px; margin: 5px 0; }
        
        #chara-container { 
            flex: 1; 
            display: flex; 
            align-items: center; 
            justify-content: center; 
            min-height: 150px; 
            max-height: 250px; 
        }
        #chara-img { max-height: 100%; width: auto; object-fit: contain; }

        #message { font-size: 16px; font-weight: bold; color: #0074d9; height: 24px; margin: 5px 0; }
        #question { font-size: 40px; margin: 5px; background: white; border-radius: 10px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
        #answer-display { font-size: 28px; color: #ff4136; margin: 5px; min-height: 35px; }
        
        .keypad { display: grid; grid-template-columns: repeat(3, 1fr); gap: 8px; max-width: 280px; margin: 0 auto; padding-bottom: 10px; }
        .btn { padding: 15px; font-size: 20px; cursor: pointer; border: none; border-bottom: 3px solid #ccc; border-radius: 8px; background: #fff; }
        .btn:active { transform: translateY(2px); border-bottom: 0; }
        .btn-orange { background: #7fdbff; border-color: #0074d9; grid-column: span 2; }
        
        /* クレジット部分のスタイル */
        .copyright { font-size: 9px; color: #666; padding: 10px 0; line-height: 1.5; background: rgba(255,255,255,0.5); border-top: 1px solid #ddd; }
        .copyright a { color: #0074d9; text-decoration: none; }
    </style>
</head>
<body>

    <h1> チルノのくく教室 </h1>

    <div id="message">あたい、天才ね！</div>

    <div id="chara-container">
        <img id="chara-img" src="normal.png" alt="キャラクター">
    </div>

    <div id="question">? × ?</div>
    <div id="answer-display">答え：<span id="current-input"></span></div>

    <div class="keypad">
        <button class="btn" onclick="addNum(1)">1</button>
        <button class="btn" onclick="addNum(2)">2</button>
        <button class="btn" onclick="addNum(3)">3</button>
        <button class="btn" onclick="addNum(4)">4</button>
        <button class="btn" onclick="addNum(5)">5</button>
        <button class="btn" onclick="addNum(6)">6</button>
        <button class="btn" onclick="addNum(7)">7</button>
        <button class="btn" onclick="addNum(8)">8</button>
        <button class="btn" onclick="addNum(9)">9</button>
        <button class="btn" style="background:#ddd" onclick="clearInput()">消す</button>
        <button class="btn" onclick="addNum(0)">0</button>
        <button class="btn" style="visibility: hidden;"></button>
        <button class="btn btn-orange" onclick="checkAnswer()">こたえあわせ！</button>
    </div>

    <div class="copyright">
        この作品は、上海アリス幻樂団様及び東方Projectの二次創作です。<br>
        本家様とは一切の関係はございません。<br>
        効果音：<a href="https://otologic.jp/" target="_blank">OtoLogic</a> / 
        BGM：<a href="https://dougasoundfx.com/" target="_blank">動画Sound～えふぇく島～</a>
    </div>

    <audio id="bgm" src="bgm.mp3" loop></audio>
    <audio id="se-correct" src="correct.mp3"></audio>
    <audio id="se-wrong" src="wrong.mp3"></audio>

    <script>
        let num1, num2, answer;
        let inputStr = "";
        const chara = document.getElementById('chara-img');
        const msg = document.getElementById('message');
        const bgm = document.getElementById('bgm');

        function nextQuestion() {
            num1 = Math.floor(Math.random() * 9) + 1;
            num2 = Math.floor(Math.random() * 9) + 1;
            answer = num1 * num2;
            document.getElementById('question').innerText = `${num1} × ${num2}`;
            inputStr = "";
            document.getElementById('current-input').innerText = "";
            chara.src = "normal.png";
        }

        function addNum(n) {
            if (bgm.paused) {
                bgm.play().catch(e => console.log("Audio play failed"));
            }
            if(inputStr.length < 2) {
                inputStr += n;
                document.getElementById('current-input').innerText = inputStr;
            }
        }

        function clearInput() {
            inputStr = "";
            document.getElementById('current-input').innerText = "";
        }

        function checkAnswer() {
            if (inputStr === "") return;
            if (parseInt(inputStr) === answer) {
                msg.innerText = "さいきょー！正解ね！";
                chara.src = "happy.png";
                document.getElementById('se-correct').play();
                setTimeout(nextQuestion, 2000);
            } else {
                msg.innerText = "あたい、まちがってないもん！";
                chara.src = "sad.png";
                document.getElementById('se-wrong').play();
                inputStr = "";
                document.getElementById('current-input').innerText = "";
            }
        }

        nextQuestion();
    </script>
</body>
</html>
